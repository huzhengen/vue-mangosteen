import{P as E,a as O,D as C}from"./vant.8c46507c.js";import{bD as b,by as m,bE as e,bL as T,bs as I,bX as S,bP as F,bO as f,bz as x}from"./vendor.619c3c28.js";import{T as q,M as L}from"./MainLayout.9e39ae53.js";import{h as P}from"./index.63fb4255.js";import{O as M,T as U,a as A}from"./Overlay.5acad421.js";import{I as D,B}from"./Icon.583548dc.js";import{v as $,h as N}from"./validate.f13e3d9d.js";const V="_dateAndAmount_1g24u_1",R="_date_1g24u_1",X="_icon_1g24u_17",z="_amount_1g24u_23",Y="_buttons_1g24u_28";var v={dateAndAmount:V,date:R,icon:X,amount:z,buttons:Y};const G=b({props:{happenAt:String,amount:Number,onSubmit:{type:Function}},emits:["update:happenAt","update:amount"],setup:(o,d)=>{const t=u=>{const h=u.toString(),g=s.value.indexOf(".");if(!(s.value.length>=13)&&!(g>=0&&s.value.length-g>2)){if(h==="."){if(g>=0)return}else if(h==="0"){if(g===-1&&s.value==="0")return}else s.value==="0"&&(s.value="");s.value+=u.toString()}},p=[{text:"1",onClick:()=>{t(1)}},{text:"2",onClick:()=>{t(2)}},{text:"3",onClick:()=>{t(3)}},{text:"4",onClick:()=>{t(4)}},{text:"5",onClick:()=>{t(5)}},{text:"6",onClick:()=>{t(6)}},{text:"7",onClick:()=>{t(7)}},{text:"8",onClick:()=>{t(8)}},{text:"9",onClick:()=>{t(9)}},{text:".",onClick:()=>{t(".")}},{text:"0",onClick:()=>{t(0)}},{text:"\u6E05\u7A7A",onClick:()=>{s.value="0"}},{text:"\u63D0\u4EA4",onClick:()=>{var u;d.emit("update:amount",parseFloat(s.value)*100),(u=o.onSubmit)==null||u.call(o)}}],i=m(!1),c=()=>i.value=!0,r=()=>i.value=!1,a=u=>{d.emit("update:happenAt",u.toISOString()),r()},s=m(o.amount?(o.amount/100).toString():"0");return()=>e(T,null,[e("div",{class:v.dateAndAmount},[e("span",{class:v.date},[e(D,{name:"date",class:v.icon},null),e("span",null,[e("span",{onClick:c},[new q(o.happenAt).format()]),e(E,{position:"bottom",show:i.value,"onUpdate:show":u=>i.value=u},{default:()=>[e(O,{modelValue:o.happenAt?new Date(o.happenAt):new Date,type:"date",title:"\u9009\u62E9\u5E74\u6708\u65E5",onConfirm:a,onCancel:r},null)]})])]),e("span",{class:v.amount},[s.value])]),e("div",{class:v.buttons},[p.map(u=>e("button",{onClick:u.onClick},[u.text]))])])}}),H="_wrapper_a2j0b_1",J="_tabs_a2j0b_7",K="_inputPad_wrapper_a2j0b_13",Q="_createTag_a2j0b_18";var k={wrapper:H,tabs:J,inputPad_wrapper:K,createTag:Q};const W=o=>{const d=m([]),t=m(0),p=m(!1),i=async()=>{const c=await o(t.value),{resources:r,pager:a}=c.data;d.value.push(...r),p.value=(a.page-1)*a.per_page+r.length<a.count,t.value+=1};return I(i),{tags:d,page:t,hasMore:p,fetchTags:i}},Z="_more_17uhv_1",ee="_tags_wrapper_17uhv_6",te="_tag_17uhv_6",ae="_sign_17uhv_20",ne="_name_17uhv_30",se="_selected_17uhv_34";var l={more:Z,tags_wrapper:ee,tag:te,sign:ae,name:ne,selected:se};const y=b({props:{kind:{type:String,required:!0},selected:Number},emits:["update:selected"],setup:(o,d)=>{const{tags:t,hasMore:p,fetchTags:i}=W(n=>P.get("/tags",{kind:o.kind,page:n+1},{_autoLoading:!0,_mock:"tagIndex"})),c=n=>{d.emit("update:selected",n.id)},r=S(),a=m(),s=m(),u=n=>{r.push(`/tags/${n}/edit?kind=${o.kind}`)},h=(n,_)=>{s.value=n.currentTarget,a.value=window.setTimeout(()=>{u(_.id)},500)},g=()=>{clearTimeout(a.value)},j=n=>{var w;const _=document.elementFromPoint(n.touches[0].clientX,n.touches[0].clientY);s.value!==_&&((w=s.value)==null?void 0:w.contains(_))===!1&&clearTimeout(a.value)};return()=>e(T,null,[e("div",{class:l.tags_wrapper,onTouchmove:n=>j(n)},[e(F,{to:`/tags/create?kind=${o.kind}`,class:l.tag},{default:()=>[e("div",{class:l.sign},[e(D,{name:"add",class:l.createTag},null)]),e("div",{class:l.name},[f("\u65B0\u589E")])]}),t.value.map(n=>e("div",{class:[l.tag,o.selected===n.id?l.selected:""],onClick:()=>c(n),onTouchstart:_=>h(_,n),onTouchend:()=>g()},[e("div",{class:l.sign},[n.sign]),e("div",{class:l.name},[n.name])]))]),e("div",{class:l.more},[p.value?e(B,{onClick:i},{default:()=>[f("\u52A0\u8F7D\u66F4\u591A\u6807\u7B7E")]}):e("span",null,[f("\u6CA1\u6709\u66F4\u591A\u6807\u7B7E\u4E86")])])])}}),pe=b({props:{name:{type:String}},setup:(o,d)=>{const t=x({kind:"income",tag_ids:[],amount:0,happen_at:new Date().toISOString()}),p=S(),i=a=>{var s;throw((s=a.response)==null?void 0:s.status)===422&&C.alert({title:"\u51FA\u9519",message:Object.values(a.response.data.errors).join(`
`)}),a},c=x({kind:[],tag_ids:[],amount:[],happen_at:[]}),r=async()=>{if(Object.assign(c,{kind:[],tag_ids:[],amount:[],happen_at:[]}),Object.assign(c,$(t,[{key:"kind",type:"required",message:"\u7C7B\u578B\u5FC5\u586B"},{key:"tag_ids",type:"required",message:"\u6807\u7B7E\u5FC5\u586B"},{key:"amount",type:"required",message:"\u91D1\u989D\u5FC5\u586B"},{key:"amount",type:"notEqual",value:0,message:"\u91D1\u989D\u4E0D\u80FD\u4E3A\u96F6"},{key:"happen_at",type:"required",message:"\u65F6\u95F4\u5FC5\u586B"}])),N(c)){C.alert({title:"\u51FA\u9519",message:Object.values(c).filter(a=>a.length>0).join(`
`)});return}await P.post("/items",t,{_autoLoading:!0,_mock:"itemCreate"}).catch(i),p.push("/items")};return()=>e(L,{class:k.layout},{title:()=>"\u5F00\u59CB\u8BB0\u8D26",icon:()=>e(M,null,null),default:()=>e(T,null,[e("div",{class:k.wrapper},[e(U,{selected:t.kind,"onUpdate:selected":a=>t.kind=a,class:k.tabs},{default:()=>[e(A,{value:"income",name:"\u6536\u5165"},{default:()=>[e(y,{kind:"income",selected:t.tag_ids[0],"onUpdate:selected":a=>t.tag_ids[0]=a},null)]}),e(A,{value:"expenses",name:"\u652F\u51FA"},{default:()=>[e(y,{kind:"expenses",selected:t.tag_ids[0],"onUpdate:selected":a=>t.tag_ids[0]=a},null)]})]}),e("div",{class:k.inputPad_wrapper},[e(G,{happenAt:t.happen_at,"onUpdate:happenAt":a=>t.happen_at=a,amount:t.amount,"onUpdate:amount":a=>t.amount=a,onSubmit:r},null)])])])})}});export{pe as ItemCreate,pe as default};
