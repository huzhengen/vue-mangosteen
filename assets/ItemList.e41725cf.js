import{u as f,h}from"./index.898e9b4c.js";import{B as _,I as b}from"./Icon.583548dc.js";import{M as i,T as D}from"./TimeTabsLayout.eb354ce5.js";import{T as v}from"./MainLayout.9e39ae53.js";import{bD as m,bx as x,bE as t,bs as F,bT as A,br as d,bz as w,bO as r,bL as p,bP as y}from"./vendor.619c3c28.js";import{C as B}from"./Center.cb6e8a51.js";import"./vant.8c46507c.js";import"./Form.90810ae0.js";import"./Overlay.8194ac06.js";const I="_total_1drlh_1",M="_list_1drlh_23",S="_sign_1drlh_30",C="_text_1drlh_42",T="_tagAndAmount_1drlh_48",E="_tag_1drlh_48",L="_amount_1drlh_55",k="_time_1drlh_58",N="_more_1drlh_63",Y="_button_1drlh_68",j="_button_wrapper_1drlh_71",q="_pig_1drlh_75",O="_pig_wrapper_1drlh_79";var s={total:I,list:M,sign:S,text:C,tagAndAmount:T,tag:E,amount:L,time:k,more:N,button:Y,button_wrapper:j,pig:q,pig_wrapper:O};const P=m({props:{value:{type:[Date,String],required:!0},format:{type:String,default:"YYYY-MM-DD HH:mm:ss"}},setup:(e,u)=>{const a=x(()=>new v(e.value).format(e.format));return()=>t("div",null,[a.value])}}),g=e=>{const u=f();F(()=>u.mePromise.then(e,()=>{}))},H=e=>A(typeof e=="string"?e:e.join("-"),{state:()=>({items:[],hasMore:!1,page:0}),actions:{async _fetch(u,a,l){if(!a||!l)return;const o=await h.get("/items",{happen_after:a,happen_before:l,page:u?1:this.page+1},{_mock:"itemIndex",_autoLoading:!0}),{resources:n,pager:c}=o.data;u?this.items=n:this.items.push(...n),this.hasMore=(c.page-1)*c.per_page+n.length<c.count,this.page+=1},async fetchNextPage(u,a){this._fetch(!1,u,a)},async fetchItems(u,a){this._fetch(!0,u,a)}}})(),V=m({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(e,u)=>{const a=H(["items",e.startDate,e.endDate]);g(()=>a.fetchItems(e.startDate,e.endDate)),d(()=>[e.startDate,e.endDate],()=>{a.$reset(),a.fetchItems(e.startDate,e.endDate)});const l=w({expenses:0,income:0,balance:0}),o=async()=>{if(!e.startDate||!e.endDate)return;const n=await h.get("/items/balance",{happen_after:e.startDate,happen_before:e.endDate},{_mock:"itemIndexBalance"});Object.assign(l,n.data)};return g(o),d(()=>[e.startDate,e.endDate],()=>{Object.assign(l,{expenses:0,income:0,balance:0}),o()}),()=>!e.startDate||!e.endDate?t("div",null,[r("\u8BF7\u5148\u9009\u62E9\u65F6\u95F4\u8303\u56F4")]):t("div",{class:s.wrapper},[a.items&&a.items.length>0?t(p,null,[t("ul",{class:s.total},[t("li",null,[t("span",null,[r("\u6536\u5165")]),t(i,{value:l.income},null)]),t("li",null,[t("span",null,[r("\u652F\u51FA")]),t(i,{value:l.expenses},null)]),t("li",null,[t("span",null,[r("\u51C0\u6536\u5165")]),t(i,{value:l.balance},null)])]),t("ol",{class:s.list},[a.items.map(n=>t("li",null,[t("div",{class:s.sign},[t("span",null,[n.tags&&n.tags.length>0?n.tags[0].sign:"\u{1F4B0}"])]),t("div",{class:s.text},[t("div",{class:s.tagAndAmount},[t("span",{class:s.tag},[n.tags&&n.tags.length>0?n.tags[0].name:"\u672A\u5206\u7C7B"]),t("span",{class:s.amount},[t(i,{value:n.amount},null)])]),t("div",{class:s.time},[t(P,{value:n.happen_at},null)])])]))]),t("div",{class:s.more},[a.hasMore?t(_,{onClick:()=>a.fetchNextPage(e.startDate,e.endDate)},{default:()=>[r("\u52A0\u8F7D\u66F4\u591A")]}):t("span",null,[r("\u6CA1\u6709\u66F4\u591A\u4E86")])])]):t(p,null,[t(B,{class:s.pig_wrapper,direction:"vertical"},{default:()=>[t(b,{name:"pig",class:s.pig},null),t("p",null,[r("\u6682\u65E0\u6570\u636E\uFF0C\u8BF7\u5148\u767B\u5F55\u6216\u8BB0\u8D26")])]}),t("div",{class:s.button_wrapper},[t(y,{to:"/items/create"},{default:()=>[t(_,{class:s.button},{default:()=>[r("\u5F00\u59CB\u8BB0\u8D26")]})]})])])])}}),X=m({setup:(e,u)=>()=>t(D,{component:V},null)});export{X as ItemList,X as default};
