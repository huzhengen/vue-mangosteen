import{g as x,M,T as A}from"./TimeTabsLayout.eb354ce5.js";import{a as C}from"./Form.90810ae0.js";import{i as T}from"./echarts.473df126.js";import{T as b}from"./MainLayout.9e39ae53.js";import{bD as d,by as p,bs as g,br as o,bE as r,bO as l,bx as v}from"./vendor.619c3c28.js";import{h as D}from"./index.898e9b4c.js";import"./Overlay.8194ac06.js";import"./Icon.583548dc.js";import"./vant.8c46507c.js";const L="_wrapper_kkstk_1";var I={wrapper:L};const Y="_wrapper_wxcjg_1";var V={wrapper:Y};const q={tooltip:{show:!0,trigger:"axis",formatter:([t])=>{const[s,e]=t.data;return`${new b(new Date(s)).format("YYYY\u5E74MM\u6708DD\u65E5")} \uFFE5${x(e)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:t=>new b(new Date(t)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{show:!1}}},E=d({props:{data:{type:Array,required:!0}},setup:(t,s)=>{const e=p();let a;return g(()=>{e.value!==void 0&&(a=T(e.value),a.setOption({...q,series:[{data:t.data,type:"line"}]}))}),o(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>r("div",{ref:e,class:V.wrapper},null)}}),F="_wrapper_1cm6i_1";var B={wrapper:F};const N={tooltip:{trigger:"item",formatter:t=>{const{name:s,value:e,percent:a}=t;return`${s}: \uFFE5${x(e)} \u5360\u6BD4 ${a}%`}},grid:[{left:0,top:0,right:0,bottom:0}],series:[{type:"pie",radius:["40%","70%"],itemStyle:{borderRadius:5,borderColor:"#fff"},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},P=d({props:{data:{type:Array}},setup:(t,s)=>{const e=p();let a;return g(()=>{e.value!==void 0&&(a=T(e.value),a.setOption(N))}),o(()=>t.data,()=>{a==null||a.setOption({series:[{data:t.data}]})}),()=>r("div",{ref:e,class:B.wrapper},null)}}),j="_wrapper_1lsgh_1",G="_topItem_1lsgh_5",R="_sign_1lsgh_11",U="_bar_wrapper_1lsgh_22",W="_bar_text_1lsgh_27",X="_bar_1lsgh_22",z="_bar_inner_1lsgh_41";var i={wrapper:j,topItem:G,sign:R,bar_wrapper:U,bar_text:W,bar:X,bar_inner:z};const H=d({props:{data:{type:Array}},setup:(t,s)=>()=>r("div",{class:i.wrapper},[t.data&&t.data.length>0?t.data.map(({tag:e,amount:a,percent:m})=>r("div",{class:i.topItem},[r("div",{class:i.sign},[e.sign]),r("div",{class:i.bar_wrapper},[r("div",{class:i.bar_text},[r("span",null,[l(" "),e.name,l(" - "),m,l("% ")]),r("span",null,[l(" \uFFE5"),r(M,{value:a},null),l(" ")])]),r("div",{class:i.bar},[r("div",{class:i.bar_inner,style:{width:`${m}%`}},null)])])])):r("div",null,[l("\u6CA1\u6709\u6570\u636E")])])}),J=24*3600*1e3,K=d({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(t,s)=>{const e=p("income"),a=p([]),m=v(()=>{if(!t.startDate||!t.endDate)return[];const u=(new Date(t.endDate).getTime()-new Date(t.startDate).getTime())/J+1;return Array.from({length:u}).map((w,O)=>{const h=new b(t.startDate+"T00:00:00.000+0800").add(O,"day").getTimestamp(),y=a.value[0],k=y&&new Date(y.happen_at+"T00:00:00.000+0800").getTime()===h?a.value.shift().amount:0;return[new Date(h).toISOString(),k]})}),c=async()=>{const n=await D.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:e.value,group_by:"happen_at"},{_autoLoading:!0,_mock:"itemSummary"});a.value=n.data.groups};g(c),o(()=>e.value,c),o(()=>t.startDate,c),o(()=>t.endDate,c);const _=p([]),$=v(()=>_.value.map(n=>({name:n.tag.name,value:n.amount}))),f=async()=>{const n=await D.get("/items/summary",{happen_after:t.startDate,happen_before:t.endDate,kind:e.value,group_by:"tag_id"},{_mock:"itemSummary"});_.value=n.data.groups};g(f),o(()=>e.value,f),o(()=>t.startDate,f),o(()=>t.endDate,f);const S=v(()=>{const n=_.value.reduce((u,w)=>u+w.amount,0);return _.value.map(u=>({...u,percent:Math.round(u.amount/n*100)}))});return()=>r("div",{class:I.wrapper},[r(C,{label:"\u7C7B\u578B",type:"select",options:[{value:"income",text:"\u6536\u5165"},{value:"expenses",text:"\u652F\u51FA"}],modelValue:e.value,"onUpdate:modelValue":n=>e.value=n},null),r(E,{data:m.value},null),r(P,{data:$.value},null),r(H,{data:S.value},null)])}}),it=d({setup:(t,s)=>()=>r(A,{rerenderOnSwitchTab:!0,hideThisYear:!0,component:K},null)});export{it as StatisticsPage,it as default};
